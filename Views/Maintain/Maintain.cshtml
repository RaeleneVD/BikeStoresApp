@{
    ViewBag.Title = "Maintain - Bike Stores";

    // Declare all variables ONCE at the top
    var staffs = ViewBag.Staffs as List<BikeStoresApp.Models.staff>;
    var staffIndex = ViewBag.StaffIndex ?? 0;
    BikeStoresApp.Models.staff staff = null;

    var customers = ViewBag.Customers as List<BikeStoresApp.Models.customer>;
    var customerIndex = ViewBag.CustomerIndex ?? 0;
    BikeStoresApp.Models.customer customer = null;

    var products = ViewBag.Products as List<BikeStoresApp.Models.product>;
    var productIndex = ViewBag.ProductIndex ?? 0;
    BikeStoresApp.Models.product product = null;

    // Get current records
    if (staffs != null && staffs.Count > 0 && staffIndex >= 0 && staffIndex < staffs.Count)
    {
        staff = staffs[staffIndex];
    }

    if (customers != null && customers.Count > 0 && customerIndex >= 0 && customerIndex < customers.Count)
    {
        customer = customers[customerIndex];
    }

    if (products != null && products.Count > 0 && productIndex >= 0 && productIndex < products.Count)
    {
        product = products[productIndex];
    }
}

<div class="container">
    <div class="row" style="margin-top: 20px;">

        <!-- STAFF CARD -->
        <div class="col-md-4">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <span>Staff Management</span>
                </div>
                <div class="panel-body">
                    @if (staff != null)
                    {
                        <p><strong>ID:</strong> @staff.staff_id</p>
                        <p><strong>First Name:</strong> @staff.first_name</p>
                        <p><strong>Last Name:</strong> @staff.last_name</p>
                        <p><strong>Email:</strong> @staff.email</p>
                        <p><strong>Phone:</strong> @staff.phone</p>
                        <p><strong>Store:</strong> @staff.store.store_name</p>

                    }
                    else
                    {
                        <p class="text-muted">No staff available.</p>
                    }
                </div>
                <div class="panel-footer">
                    <div class="btn-group btn-group-justified" role="group">
                        @if (staffs != null && staffIndex > 0)
                        {
                            <a href="@Url.Action("Maintain", new { staffIndex = staffIndex - 1, customerIndex = customerIndex, productIndex = productIndex })" class="btn btn-default">
                                <span class="glyphicon glyphicon-chevron-left"></span> Prev
                            </a>
                        }
                        else
                        {
                            <a class="btn btn-default disabled">
                                <span class="glyphicon glyphicon-chevron-left"></span> Prev
                            </a>
                        }

                        <a class="btn btn-default disabled">@(staffIndex + 1) / @(staffs?.Count ?? 0)</a>

                        @if (staffs != null && staffIndex < staffs.Count - 1)
                        {
                            <a href="@Url.Action("Maintain", new { staffIndex = staffIndex + 1, customerIndex = customerIndex, productIndex = productIndex })" class="btn btn-default">
                                Next <span class="glyphicon glyphicon-chevron-right"></span>
                            </a>
                        }
                        else
                        {
                            <a class="btn btn-default disabled">
                                Next <span class="glyphicon glyphicon-chevron-right"></span>
                            </a>
                        }
                    </div>
                    @if (staff != null)
                    {
                        <div class="btn-group btn-group-justified" role="group" style="margin-top: 10px;">
                            <a class="btn btn-warning" data-toggle="modal" data-target="#editStaffModal">
                                <span class="glyphicon glyphicon-edit"></span> Edit
                            </a>
                            <a href="@Url.Action("DeleteStaff", new { id = staff.staff_id })" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this staff member?')">
                                <span class="glyphicon glyphicon-trash"></span> Delete
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- CUSTOMER CARD -->
        <div class="col-md-4">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <span>Customer Management</span>
                </div>
                <div class="panel-body">
                    @if (customer != null)
                    {
                        <p><strong>ID:</strong> @customer.customer_id</p>
                        <p><strong>First Name:</strong> @customer.first_name</p>
                        <p><strong>Last Name:</strong> @customer.last_name</p>
                        <p><strong>Email:</strong> @customer.email</p>
                        <p><strong>Phone:</strong> @customer.phone</p>
                        <p><strong>City:</strong> @customer.city</p>
                    }
                    else
                    {
                        <p class="text-muted">No customers available.</p>
                    }
                </div>
                <div class="panel-footer">
                    <div class="btn-group btn-group-justified" role="group">
                        @if (customers != null && customerIndex > 0)
                        {
                            <a href="@Url.Action("Maintain", new { staffIndex = staffIndex, customerIndex = customerIndex - 1, productIndex = productIndex })" class="btn btn-default">
                                <span class="glyphicon glyphicon-chevron-left"></span> Prev
                            </a>
                        }
                        else
                        {
                            <a class="btn btn-default disabled">
                                <span class="glyphicon glyphicon-chevron-left"></span> Prev
                            </a>
                        }

                        <a class="btn btn-default disabled">@(customerIndex + 1) / @(customers?.Count ?? 0)</a>

                        @if (customers != null && customerIndex < customers.Count - 1)
                        {
                            <a href="@Url.Action("Maintain", new { staffIndex = staffIndex, customerIndex = customerIndex + 1, productIndex = productIndex })" class="btn btn-default">
                                Next <span class="glyphicon glyphicon-chevron-right"></span>
                            </a>
                        }
                        else
                        {
                            <a class="btn btn-default disabled">
                                Next <span class="glyphicon glyphicon-chevron-right"></span>
                            </a>
                        }
                    </div>
                    @if (customer != null)
                    {
                        <div class="btn-group btn-group-justified" role="group" style="margin-top: 10px;">
                            <a class="btn btn-warning" data-toggle="modal" data-target="#editCustomerModal">
                                <span class="glyphicon glyphicon-edit"></span> Edit
                            </a>
                            <a href="@Url.Action("DeleteCustomer", new { id = customer.customer_id })" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this customer?')">
                                <span class="glyphicon glyphicon-trash"></span> Delete
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- PRODUCT CARD -->
        <div class="col-md-4">
            <div class="panel panel-warning">
                <div class="panel-heading">
                    <form method="get" class="form-inline">
                        <div class="form-group">
                            <label>Brand:</label>
                            <select name="brandId" class="form-control input-sm" style="width: auto;">
                                <option value="">All</option>
                                @foreach (var brand in ViewBag.Brands ?? new List<BikeStoresApp.Models.brand>())
                                {
                                    <option value="@brand.brand_id">@brand.brand_name</option>
                                }
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Category:</label>
                            <select name="categoryId" class="form-control input-sm" style="width: auto;">
                                <option value="">All</option>
                                @foreach (var category in ViewBag.Categories ?? new List<BikeStoresApp.Models.category>())
                                {
                                    <option value="@category.category_id">@category.category_name</option>
                                }
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary btn-xs">
                            <span class="glyphicon glyphicon-filter"></span> Filter
                        </button>
                    </form>
                </div>
                <div class="panel-body">



                    @if (product != null)
                    {
                        @* Display bike image *@

                        var random = new Random();
                        var randomIndex = random.Next(1, 19); // Assuming 20 images named Bike1 to Bike20
                        var imagePath = Url.Content($"~/Images/Bike{randomIndex}.jpeg");

                        <img src="@imagePath" alt="@product.brand.brand_name"
                             class="img-thumbnail"
                             style="width:200px;height:auto;"
                             onerror="this.src='@Url.Content("~/Images/placeholder.jpeg")'; this.onerror=null;" />

                        <p><strong>ID:</strong> @product.product_id</p>
                        <p><strong>Name:</strong> @product.product_name</p>
                        <p><strong>Brand:</strong> @product.brand.brand_name</p>
                        <p><strong>Category:</strong> @product.category.category_name</p>
                        <p><strong>Year:</strong> @product.model_year</p>
                        <p><strong>Price:</strong> $@product.list_price</p>
                    }
                    else
                    {
                        <p class="text-muted">No products found.</p>
                    }
                </div>
                <div class="panel-footer">
                    <div class="btn-group btn-group-justified" role="group">
                        @if (products != null && productIndex > 0)
                        {
                            <a href="@Url.Action("Maintain", new { staffIndex = staffIndex, customerIndex = customerIndex, productIndex = productIndex - 1, brandId = Request.QueryString["brandId"], categoryId = Request.QueryString["categoryId"] })" class="btn btn-default">
                                <span class="glyphicon glyphicon-chevron-left"></span> Prev
                            </a>
                        }
                        else
                        {
                            <a class="btn btn-default disabled">
                                <span class="glyphicon glyphicon-chevron-left"></span> Prev
                            </a>
                        }

                        <a class="btn btn-default disabled">@(productIndex + 1) / @(products?.Count ?? 0)</a>

                        @if (products != null && productIndex < products.Count - 1)
                        {
                            <a href="@Url.Action("Maintain", new { staffIndex = staffIndex, customerIndex = customerIndex, productIndex = productIndex + 1, brandId = Request.QueryString["brandId"], categoryId = Request.QueryString["categoryId"] })" class="btn btn-default">
                                Next <span class="glyphicon glyphicon-chevron-right"></span>
                            </a>
                        }
                        else
                        {
                            <a class="btn btn-default disabled">
                                Next <span class="glyphicon glyphicon-chevron-right"></span>
                            </a>
                        }
                    </div>
                    @if (product != null)
                    {
                        <div class="btn-group btn-group-justified" role="group" style="margin-top: 10px;">
                            <a class="btn btn-warning" data-toggle="modal" data-target="#editProductModal">
                                <span class="glyphicon glyphicon-edit"></span> Edit
                            </a>
                            <a href="@Url.Action("DeleteProduct", new { id = product.product_id })" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this product?')">
                                <span class="glyphicon glyphicon-trash"></span> Delete
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>

    </div>
</div>

<!-- EDIT STAFF MODAL -->
<div class="modal fade" id="editStaffModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Edit Staff Member</h4>
            </div>
            <div class="modal-body">
                @if (staff != null)
                {
                    @Html.Partial("EditStaff", staff)
                }
                else
                {
                    <p class="text-muted">No staff selected.</p>
                }
            </div>
        </div>
    </div>
</div>

<!-- EDIT CUSTOMER MODAL -->
<div class="modal fade" id="editCustomerModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Edit Customer</h4>
            </div>
            <div class="modal-body">
                @if (customer != null)
                {
                    @Html.Partial("EditCustomer", customer)
                }
                else
                {
                    <p class="text-muted">No customer selected.</p>
                }
            </div>
        </div>
    </div>
</div>

<!-- EDIT PRODUCT MODAL -->
<div class="modal fade" id="editProductModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Edit Product</h4>
            </div>
            <div class="modal-body">
                @if (product != null)
                {
                    @Html.Partial("EditProduct", product)
                }
                else
                {
                    <p class="text-muted">No product selected.</p>
                }
            </div>
        </div>
    </div>
</div>